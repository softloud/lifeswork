[
["analysis.html", "section 2 analysis 2.1 wrangling 2.2 intensity achieved 2.3 distribution of work", " section 2 analysis 2.1 wrangling # packages used in this chapter library(tidyverse) library(googlesheets) library(usethis) library(dontpanic) library(lubridate) library(ggmosaic) library(latex2exp) # register sheet measures &lt;- gs_key(measures_gs_key) # import workload key workload_key &lt;- measures %&gt;% gs_read(ws = &quot;workload_key&quot;) # import data atracker_data &lt;- read_csv(timetracker_path) write_csv(atracker_data, &quot;data/atracker_data.csv&quot;) timer_raw &lt;- read_csv(&quot;data/atracker_data.csv&quot;) timer &lt;- timer_raw %&gt;% # tidy column names dplyr::rename( task = `Task name`, description = `Task description`, start = `Start time`, finish = `End time`, duration = Duration, duration_hrs = `Duration in hours`, note = Note, category = Tag ) %&gt;% dplyr::mutate( # get date object, as I&#39;ll want to do things by day start = lubridate::dmy_hm(start), finish = lubridate::dmy_hm(finish), date = lubridate::date(start) ) %&gt;% dplyr::filter(!str_detect(category, &quot;pi&quot;)) intensities &lt;- c( &quot;nothing&quot;, &quot;sweet fuck all&quot;, &quot;eh, got some stuff done&quot;, &quot;pretty good effort&quot;, &quot;eaglescream&quot; ) daily_work &lt;- timer %&gt;% mutate(duration_hrs = if_else(is.na(duration_hrs), 0, duration_hrs)) %&gt;% dplyr::filter(category == &quot;phi&quot; | category == &quot;theta&quot; | category == &quot;psi&quot;) %&gt;% select(-note,-description) %&gt;% group_by(date, category) %&gt;% summarise(hrs = sum(duration_hrs)) workload &lt;- workload_key %&gt;% gather(key = category, value = poms_goal, -workload) %&gt;% mutate(goal = (poms_goal * 20) / 60) %&gt;% select(-poms_goal) %&gt;% spread(key = workload, value = goal) intensity &lt;- full_join(daily_work, workload, by = &quot;category&quot;) %&gt;% mutate(category_intensity = case_when( hrs == 0 ~ intensities[1], hrs &lt; light ~ intensities[2], hrs &lt; moderate ~ intensities[3], hrs &lt; hardcore ~ intensities[4], hrs &gt; hardcore ~ intensities[5] )) %&gt;% group_by(date) %&gt;% mutate(daily_intensity = case_when( all(hrs &gt; hardcore) ~ intensities[5], all(hrs &gt; moderate) ~ intensities[4], all(hrs &gt; light) ~ intensities[3], any(hrs &lt; light) ~ intensities[2], all(hrs == 0) ~ intensities[1] )) count_workload &lt;- function(days = 10, era) { intensity %&gt;% dplyr::filter(date &gt; today() - days) %&gt;% ungroup() %&gt;% count(category, category_intensity, daily_intensity) %&gt;% mutate(era = days) } quinque &lt;- count_workload(days = 5) decade &lt;- count_workload(days = 10) century &lt;- count_workload(days = 100) mosaic_data &lt;- count_workload(days = 1000) %&gt;% bind_rows(quinque, decade, century) %&gt;% ungroup() %&gt;% mutate( category = fct_relevel(category, &quot;phi&quot;, &quot;theta&quot;, &quot;psi&quot;), category_intensity = fct_relevel(category_intensity, intensities), daily_intensity = fct_relevel(daily_intensity, intensities), era_plot = case_when( era == 5 ~ &quot;quinque&quot;, # &quot;\\\\romannumeral{5}&quot;, era == 10 ~ &quot;decade&quot;, # &quot;\\\\romannumeral{10}&quot;, era == 100 ~ &quot;century&quot;, # &quot;\\\\romannumeral{100}&quot;, era == 1000 ~ &quot;millenium&quot; # &quot;\\\\romannumeral{1000}&quot; ), era_plot = fct_relevel(era_plot, &quot;quinque&quot;, &quot;decade&quot;, &quot;century&quot;, &quot;millenium&quot;), category = fct_relevel(category, &quot;phi&quot;, &quot;theta&quot;, &quot;psi&quot;) ) ## Warning: Unknown levels in `f`: nothing ## Warning: Unknown levels in `f`: nothing category_boxplot &lt;- intensity %&gt;% mutate(era = 1000) %&gt;% bind_rows( intensity %&gt;% dplyr::filter(date &gt; today() - 5) %&gt;% mutate(era = 5), intensity %&gt;% dplyr::filter(date &gt; today() - 10) %&gt;% mutate(era = 10), intensity %&gt;% dplyr::filter(date &gt; today() - 100) %&gt;% mutate(era = 100) ) %&gt;% mutate( era_plot = case_when(era == 5 ~ &quot;quinque&quot;, # &quot;\\\\romannumeral{5}&quot;, era == 10 ~ &quot;decade&quot;, # &quot;\\\\romannumeral{10}&quot;, era == 100 ~ &quot;century&quot;, # &quot;\\\\romannumeral{100}&quot;, era == 1000 ~ &quot;millenium&quot;), era_plot = fct_relevel(era_plot, &quot;quinque&quot;, &quot;decade&quot;, &quot;century&quot;, &quot;millenium&quot;), category = fct_relevel(category, &quot;phi&quot;, &quot;theta&quot;, &quot;psi&quot;) ) %&gt;% ggplot(aes(x = category, y = hrs)) + geom_boxplot() + geom_hline( yintercept = 4 / 3, linetype = &quot;dotted&quot;, alpha = 0.7, colour = &quot;darkgrey&quot;, size = 1.5 ) + facet_grid(era_plot ~ ., scales = &quot;free&quot;) + coord_flip() + labs( title = str_wrap(&quot;distribution of work done over different periods of time&quot;), x = &quot;hours of work completed&quot;, y = &quot;category of work&quot;, caption = &quot;dotted vertical line indicates daily goal for that category&quot; ) 2.2 intensity achieved intensity_mosaic 2.3 distribution of work category_boxplot "]
]
