# analysis {#analysis}

```{r get measures data, eval=FALSE} 

# from this issue: https://github.com/jennybc/googlesheets/issues/320#issuecomment-372076823


```

```{r get timer data, eval=FALSE}

```


```{r wrangle timer data}
timer_raw <- read_rds("data/timer_raw.rds")

timer <-  timer_raw %>%
      # tidy column names
      dplyr::rename(
        task = `Task name`,
        description = `Task description`,
        start = `Start time`,
        finish = `End time`,
        duration = Duration,
        duration_hrs = `Duration in hours`,
        note = Note,
        category = Tag
      ) %>%
      dplyr::mutate(
        # get date object, as I'll want to do things by day
        start = lubridate::dmy_hm(start),
        finish = lubridate::dmy_hm(finish),
        date = lubridate::date(start)
      )

```


```{r wrangle measures data, message=FALSE, warning=FALSE}
measures <- read_rds("data/measures.rds")

intensities <- c(
  "nothing",
  "sweet fuck all",
  "eh, got some stuff done",
  "pretty good effort",
  "eaglescream"
)

goals <- measures %>% 
  pluck("workload") %>%
  select(workload, phi_hrs, theta_hrs, psi_hrs) %>%
  gather(key = "category", value = "poms", phi_hrs, theta_hrs, psi_hrs) %>%
  spread(key = "workload", value = "poms") %>%
  mutate(category = str_sub(category, end = -5))

daily_work <- timer %>%
  mutate(duration_hrs = if_else(is.na(duration_hrs), 0, duration_hrs)) %>%
  dplyr::filter(category == "phi" |
                  category == "theta" | category == "psi") %>%
  select(-note,-description) %>%
  group_by(date, category) %>%
  summarise(hrs = sum(duration_hrs)) %>%
  left_join(goals) %>%
  mutate(
    category_workload = case_when(
      hrs == 0 ~ intensities[[1]],
      hrs < light ~ intensities[[2]],
      hrs < moderate ~ intensities[[3]],
      hrs < hardcore ~ intensities[[4]],
      hrs > hardcore ~ intensities[[5]]
   ) 
  ) %>%
  group_by(date) %>%
  mutate(
    daily_workload = case_when(
      any(hrs == 0) ~ intensities[[1]],
      any(hrs < light) ~ intensities[[2]],
      any(hrs < moderate) ~ intensities[[3]],
      any(hrs < hardcore) ~ intensities[[4]],
      all(hrs > hardcore) ~ intensities[[5]]
    )
  )


count_workload <- function(days = 10){

  counts <- daily_work %>%
    dplyr::ungroup() %>%
    dplyr::filter(date > lubridate::today() - days) %>%
    dplyr::group_by(category) %>%
    dplyr::count(category_workload)

  return(
    counts
  )
}

quinque <- count_workload(days = 5) %>%
  mutate(period = "v")

decade <-  count_workload(days = 10) %>%
  mutate(period = "x")

century <- count_workload(days = 100) %>%
  mutate(period = "c")

daily_measures <- suppressMessages({
  count_workload(days = 1000) %>%
  mutate(period = "m") %>%
  bind_rows(quinque, decade, century) %>%
  ungroup() %>%
  mutate(
    category = fct_relevel(category, "phi", "theta", "psi"),
    period = fct_relevel(period, "v", "x", "c", "m")
  ) %>%
  full_join(daily_work) %>%
  mutate(
    daily_workload = fct_relevel(daily_workload, intensities),
    category_workload = fct_relevel(category_workload, intensities))  
})

  



```


## workload intensity goals achieved

```{r vis, echo=FALSE, message=FALSE, warning=FALSE}

daily_measures %>% 
    ggplot2::ggplot()+
    ggmosaic::geom_mosaic(
      aes(x = product(daily_workload),
          fill = category_workload,
          weight = n)) +
    scale_fill_grey(start = 0.8, end = 0.2) +
ggplot2::theme(axis.text.y = element_blank(),
      axis.ticks.y = element_blank(),
      axis.text.x = element_text(angle = 35, hjust = 1))+ 
  facet_grid(period ~ category, labeller = label_parsed) 



```


## distribution of hrs spent per day per category

```{r density periods, echo=FALSE}
daily_measures %>% 
    ggplot2::ggplot(aes(x = hrs))+
    geom_density(colour = "darkgrey", fill = "darkgrey") +
  facet_grid(category ~ period, scales = "free") 



```


```{r boxplots categories, echo=FALSE}
daily_measures %>% 
  ggplot(aes(x = category, y = hrs)) +
  geom_boxplot() +
  facet_grid(period ~ ., 
             scales = "free",
             labeller = label_parsed) +
  coord_flip()


```

